<script>
  // Funzione di trascinamento popup
  (function enableDragPopup() {
    const popup = document.getElementById('popup');
    const header = document.getElementById('popupHeader');
    let offsetX = 0, offsetY = 0, startX = 0, startY = 0;

    header.addEventListener('mousedown', dragStart);
    header.addEventListener('touchstart', dragStart, { passive: false });

    function dragStart(e) {
      e.preventDefault();
      if (e.type === 'mousedown') {
        startX = e.clientX;
        startY = e.clientY;
        document.addEventListener('mousemove', dragMove);
        document.addEventListener('mouseup', dragEnd);
      } else if (e.type === 'touchstart') {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        document.addEventListener('touchmove', dragMove, { passive: false });
        document.addEventListener('touchend', dragEnd);
      }
      const rect = popup.getBoundingClientRect();
      offsetX = startX - rect.left;
      offsetY = startY - rect.top;
    }

    function dragMove(e) {
      e.preventDefault();
      let clientX, clientY;
      if (e.type === 'mousemove') {
        clientX = e.clientX;
        clientY = e.clientY;
      } else {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      }
      popup.style.top = (clientY - offsetY) + 'px';
      popup.style.left = (clientX - offsetX) + 'px';
      popup.style.right = 'auto';
    }

    function dragEnd(e) {
      document.removeEventListener('mousemove', dragMove);
      document.removeEventListener('mouseup', dragEnd);
      document.removeEventListener('touchmove', dragMove);
      document.removeEventListener('touchend', dragEnd);
    }
  })();
</script>
